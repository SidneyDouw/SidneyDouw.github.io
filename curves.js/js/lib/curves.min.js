!function(t,i){"function"==typeof define&&define.amd?define([],i):t.Curve=i()}(this,function(){var t,i,o;return function(s){function n(t,i){return g.call(t,i)}function p(t,i){var o,s,n,p,e,c,h,r,l,a,u,x=i&&i.split("/"),f=w.map,v=f&&f["*"]||{};if(t&&"."===t.charAt(0))if(i){for(t=t.split("/"),e=t.length-1,w.nodeIdCompat&&b.test(t[e])&&(t[e]=t[e].replace(b,"")),t=x.slice(0,x.length-1).concat(t),l=0;l<t.length;l+=1)if(u=t[l],"."===u)t.splice(l,1),l-=1;else if(".."===u){if(1===l&&(".."===t[2]||".."===t[0]))break;l>0&&(t.splice(l-1,2),l-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((x||v)&&f){for(o=t.split("/"),l=o.length;l>0;l-=1){if(s=o.slice(0,l).join("/"),x)for(a=x.length;a>0;a-=1)if(n=f[x.slice(0,a).join("/")],n&&(n=n[s])){p=n,c=l;break}if(p)break;!h&&v&&v[s]&&(h=v[s],r=l)}!p&&h&&(p=h,c=r),p&&(o.splice(0,c,p),t=o.join("/"))}return t}function e(t,i){return function(){var o=k.call(arguments,0);return"string"!=typeof o[0]&&1===o.length&&o.push(null),x.apply(s,o.concat([t,i]))}}function c(t){return function(i){return p(i,t)}}function h(t){return function(i){y[t]=i}}function r(t){if(n(d,t)){var i=d[t];delete d[t],m[t]=!0,u.apply(s,i)}if(!n(y,t)&&!n(m,t))throw new Error("No "+t);return y[t]}function l(t){var i,o=t?t.indexOf("!"):-1;return o>-1&&(i=t.substring(0,o),t=t.substring(o+1,t.length)),[i,t]}function a(t){return function(){return w&&w.config&&w.config[t]||{}}}var u,x,f,v,y={},d={},w={},m={},g=Object.prototype.hasOwnProperty,k=[].slice,b=/\.js$/;f=function(t,i){var o,s=l(t),n=s[0];return t=s[1],n&&(n=p(n,i),o=r(n)),n?t=o&&o.normalize?o.normalize(t,c(i)):p(t,i):(t=p(t,i),s=l(t),n=s[0],t=s[1],n&&(o=r(n))),{f:n?n+"!"+t:t,n:t,pr:n,p:o}},v={require:function(t){return e(t)},exports:function(t){var i=y[t];return"undefined"!=typeof i?i:y[t]={}},module:function(t){return{id:t,uri:"",exports:y[t],config:a(t)}}},u=function(t,i,o,p){var c,l,a,u,x,w,g=[],k=typeof o;if(p=p||t,"undefined"===k||"function"===k){for(i=!i.length&&o.length?["require","exports","module"]:i,x=0;x<i.length;x+=1)if(u=f(i[x],p),l=u.f,"require"===l)g[x]=v.require(t);else if("exports"===l)g[x]=v.exports(t),w=!0;else if("module"===l)c=g[x]=v.module(t);else if(n(y,l)||n(d,l)||n(m,l))g[x]=r(l);else{if(!u.p)throw new Error(t+" missing "+l);u.p.load(u.n,e(p,!0),h(l),{}),g[x]=y[l]}a=o?o.apply(y[t],g):void 0,t&&(c&&c.exports!==s&&c.exports!==y[t]?y[t]=c.exports:a===s&&w||(y[t]=a))}else t&&(y[t]=o)},t=i=x=function(t,i,o,n,p){if("string"==typeof t)return v[t]?v[t](i):r(f(t,i).f);if(!t.splice){if(w=t,w.deps&&x(w.deps,w.callback),!i)return;i.splice?(t=i,i=o,o=null):t=s}return i=i||function(){},"function"==typeof o&&(o=n,n=p),n?u(s,t,i,o):setTimeout(function(){u(s,t,i,o)},4),x},x.config=function(t){return x(t)},t._defined=y,o=function(t,i,o){if("string"!=typeof t)throw new Error("See almond README: incorrect module build, no module name");i.splice||(o=i,i=[]),n(y,t)||n(d,t)||(d[t]=[t,i,o])},o.amd={jQuery:!0}}(),o("almond",function(){}),o("modules/Point",[],function(){function t(t,i,o,s,n){this.x=t,this.y=i,this.r=s/2,this.color=o,this.ctx=n}return t.prototype.draw=function(){this.ctx.fillStyle=this.color,this.ctx.beginPath(),this.ctx.arc(this.x,this.y,this.r,0,2*Math.PI,!1),this.ctx.closePath(),this.ctx.fill()},t}),o("modules/BezierPoint",["modules/Point"],function(t){function i(i,o,s,n,p,e){this.cpDist=e,this.color=n,this.size=p,this.position=new t(i,o,this.color,this.size,s),this.cp1=new t(i-this.cpDist,o,this.color,this.size,s),this.cp2=new t(i+this.cpDist,o,this.color,this.size,s),this.ctx=s,this.r=2,this.collapsed=!1}return i.prototype.collapse=function(){this.collapsed?(this.collapsed=!1,this.cp1.x=this.position.x-this.cpDist,this.cp2.x=this.position.x+this.cpDist):(this.collapsed=!0,this.cp1.x=this.cp2.x=this.position.x,this.cp1.y=this.cp2.y=this.position.y)},i.prototype.move=function(){this.collapsed?this.v1x=this.v1y=this.v2x=this.v2y=0:(this.v1x=this.cp1.x-this.position.x,this.v1y=this.cp1.y-this.position.y,this.v2x=this.cp2.x-this.position.x,this.v2y=this.cp2.y-this.position.y)},i.prototype.setPointStyle=function(t,i){this.position.color=t,this.cp1.color=t,this.cp2.color=t,this.position.r=i/2,this.cp1.r=i/2,this.cp2.r=i/2},i.prototype.draw=function(){this.ctx.lineWidth=.2,this.ctx.beginPath(),this.ctx.moveTo(this.position.x,this.position.y),this.ctx.lineTo(this.cp1.x,this.cp1.y),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(this.position.x,this.position.y),this.ctx.lineTo(this.cp2.x,this.cp2.y),this.ctx.stroke(),this.position.draw(),this.cp1.draw(),this.cp2.draw()},i}),o("modules/Curve",["modules/BezierPoint"],function(t){function i(i,o,s){this.cpDist=s?s:.2*i.canvas.width,this.pointColor="#f00",this.pointSize=4,this.lineColor="#fff",this.lineWidth=1,this.points=[new t(0,i.canvas.height,i,this.pointColor,this.pointSize,this.cpDist),new t(i.canvas.width,0,i,this.pointColor,this.pointSize,this.cpDist)],this.ctx=i,this.cw=i.canvas.width,this.ch=i.canvas.height,this.mouseX=0,this.mouseY=0,this.events={},this.interval=o,this.canvasEvents(),this.createLUT(),this.draw()}i.prototype.xGetY=function(t){for(var i=1e-4,o=0,s=5e3,n=(o+s)/2,p=t/this.interval,e=this.lookupX[n],c=0;Math.abs(p-e)>i&&(c++,e>p?s=n:p>e&&(o=n),n=Math.round((o+s)/2),e=this.lookupX[n],!(c>20)););return this.lookupY[n]},i.prototype.createLUT=function(){this.lookupX=[],this.lookupY=[];for(var t=1;t<this.points.length;t++)for(var i=this.points[t-1],o=this.points[t],s=o.position.x/this.cw-i.position.x/this.cw,n=0;1>n;n+=1/(5e3*s)){var p=Math.pow(1-n,3)*i.position.x+3*Math.pow(1-n,2)*n*i.cp2.x+3*(1-n)*Math.pow(n,2)*o.cp1.x+Math.pow(n,3)*o.position.x,e=Math.pow(1-n,3)*i.position.y+3*Math.pow(1-n,2)*n*i.cp2.y+3*(1-n)*Math.pow(n,2)*o.cp1.y+Math.pow(n,3)*o.position.y;this.lookupX.push(p/this.cw),this.lookupY.push(-e/this.ch+1)}},i.prototype.on=function(t,i){this.events["on"+t]=i.bind(this)},i.prototype.canvasEvents=function(){var t,i,s,n,p,e,c=this;this.ctx.canvas.addEventListener("mousemove",function(h){var r=this.getBoundingClientRect();t=h.clientX-r.left,i=h.clientY-r.top,c.mouseX=t,c.mouseY=i;for(var l=0;l<c.points.length;l++){var a=c.points[l];if(!e){if(s=Math.sqrt((t-a.position.x)*(t-a.position.x)+(i-a.position.y)*(i-a.position.y)),s<=c.pointSize/2+2){this.style.cursor="pointer",n=l;break}if(s=Math.sqrt((t-a.cp1.x)*(t-a.cp1.x)+(i-a.cp1.y)*(i-a.cp1.y)),s<=c.pointSize/2+2){this.style.cursor="pointer",n=l,p="cp1";break}if(s=Math.sqrt((t-a.cp2.x)*(t-a.cp2.x)+(i-a.cp2.y)*(i-a.cp2.y)),s<=c.pointSize/2+2){this.style.cursor="pointer",n=l,p="cp2";break}this.style.cursor="initial",n=!1,p=!1}}if(o[18]){var u=c.cw/20,x=c.ch/10,f=Math.floor((t+u/2)/u),v=Math.floor((i+x/2)/x);t=u*f,i=x*v}if(e){if("cp1"==p)c.points[n].cp1.x=t,c.points[n].cp1.y=i,c.points[n].move(),o[16]||(c.points[n].cp2.x=t-2*c.points[n].v1x,c.points[n].cp2.y=i-2*c.points[n].v1y);else if("cp2"==p)c.points[n].cp2.x=t,c.points[n].cp2.y=i,c.points[n].move(),o[16]||(c.points[n].cp1.x=t-2*c.points[n].v2x,c.points[n].cp1.y=i-2*c.points[n].v2y);else{c.points[n].move(),c.points[n].position.x=t,c.points[n].position.y=i,0===n&&(c.points[n].position.x=0),n==c.points.length-1&&(c.points[n].position.x=c.cw),c.points[n].cp1.x=c.points[n].position.x+c.points[n].v1x,c.points[n].cp1.y=c.points[n].position.y+c.points[n].v1y,c.points[n].cp2.x=c.points[n].position.x+c.points[n].v2x,c.points[n].cp2.y=c.points[n].position.y+c.points[n].v2y;var y;c.points[n-1]&&c.points[n+1]&&(c.points[n].position.x>c.points[n+1].position.x&&(y=c.points[n],c.points[n]=c.points[n+1],c.points[n+1]=y,n++),c.points[n-1].position.x>c.points[n].position.x&&(y=c.points[n],c.points[n]=c.points[n-1],c.points[n-1]=y,n--))}c.events.ondrag?c.events.ondrag():null,c.draw()}c.events.onmousemove?c.events.onmousemove():null}),this.ctx.canvas.addEventListener("mousedown",function(o){o.preventDefault(),n||0===n?e=!0:s>5&&(n=c.addPoint(t,i),e=!0,this.style.cursor="pointer",c.draw(),c.events.onnewpoint?c.events.onnewpoint():null)}),this.ctx.canvas.addEventListener("mouseup",function(o){e=!1,s>5&&(n=p=!1);for(var h=0;h<c.points.length;h++){var r=c.points[h];if(s=Math.sqrt((t-r.position.x)*(t-r.position.x)+(i-r.position.y)*(i-r.position.y)),s<=c.pointSize/2+2){this.style.cursor="pointer",n=h;break}}c.createLUT()}),this.ctx.canvas.addEventListener("mouseleave",function(s){e&&(s.offsetX<0||s.offsetX>c.cw?s.offsetX<0?"cp1"==p?(c.points[n].cp1.x=0,c.points[n].move(),o[16]||(c.points[n].cp2.x=0-2*c.points[n].v1x,c.points[n].cp2.y=i-2*c.points[n].v1y)):"cp2"==p?(c.points[n].cp2.x=0,c.points[n].move(),o[16]||(c.points[n].cp1.x=0-2*c.points[n].v2x,c.points[n].cp1.y=i-2*c.points[n].v2y)):(c.points[n].position.x=0,c.points[n].cp1.x=0+c.points[n].v1x,c.points[n].cp2.x=0+c.points[n].v2x):"cp1"==p?(c.points[n].cp1.x=c.cw,c.points[n].move(),o[16]||(c.points[n].cp2.x=c.cw-2*c.points[n].v1x,c.points[n].cp2.y=i-2*c.points[n].v1y)):"cp2"==p?(c.points[n].cp2.x=c.cw,c.points[n].move(),o[16]||(c.points[n].cp1.x=c.cw-2*c.points[n].v2x,c.points[n].cp1.y=i-2*c.points[n].v2y)):(c.points[n].position.x=c.cw,c.points[n].cp1.x=c.cw+c.points[n].v1x,c.points[n].cp2.x=c.cw+c.points[n].v2x):(s.offsetY<0||s.offsetY>c.ch)&&(s.offsetY<0?"cp1"==p?(c.points[n].cp1.y=0,c.points[n].move(),o[16]||(c.points[n].cp2.x=t-2*c.points[n].v1x,c.points[n].cp2.y=0-2*c.points[n].v1y)):"cp2"==p?(c.points[n].cp2.y=0,c.points[n].move(),o[16]||(c.points[n].cp1.x=t-2*c.points[n].v2x,c.points[n].cp1.y=0-2*c.points[n].v2y)):(c.points[n].position.y=0,c.points[n].cp1.y=0+c.points[n].v1y,c.points[n].cp2.y=0+c.points[n].v2y):"cp1"==p?(c.points[n].cp1.y=c.ch,c.points[n].move(),o[16]||(c.points[n].cp2.x=t-2*c.points[n].v1x,c.points[n].cp2.y=c.ch-2*c.points[n].v1y)):"cp2"==p?(c.points[n].cp2.y=c.ch,c.points[n].move(),o[16]||(c.points[n].cp1.x=t-2*c.points[n].v2x,c.points[n].cp1.y=c.ch-2*c.points[n].v2y)):(c.points[n].position.y=c.ch,c.points[n].cp1.y=c.ch+c.points[n].v1y,c.points[n].cp2.y=c.ch+c.points[n].v2y))),c.draw(),c.createLUT(),e=n=p=!1}),this.ctx.canvas.addEventListener("click",function(t){o[16]&&!p&&(c.points[n].collapse(),c.draw(),c.createLUT(),c.events.ontogglecontrol?c.events.ontogglecontrol():null)}),this.ctx.canvas.addEventListener("dblclick",function(t){c.points.splice(n,1),e=n=p=!1,s=1e3,this.style.cursor="initial",c.draw(),c.createLUT(),c.events.onremovepoint?c.events.onremovepoint():null})},i.prototype.addPoint=function(i,o){this.points.push(new t(i,o,this.ctx,this.pointColor,this.pointSize,this.cpDist)),this.points.sort(function(t,i){return t.position.x-i.position.x});for(var s=0;s<this.points.length;s++){var n=this.points[s];if(i==n.position.x&&o==n.position.y)return s}},i.prototype.setPointStyle=function(t,i){for(var o=0;o<this.points.length;o++)this.points[o].setPointStyle(t,i),this.pointColor=t,this.pointSize=i;this.draw()},i.prototype.setLineStyle=function(t,i){this.lineColor=t,this.lineWidth=i,this.draw()},i.prototype.draw=function(){for(this.ctx.clearRect(0,0,this.cw,this.ch),this.ctx.strokeStyle="#444",this.ctx.lineWidth=1,o=1;10>o;o++)this.ctx.beginPath(),this.ctx.moveTo(this.cw/10*o-.5,0),this.ctx.lineTo(this.cw/10*o-.5,this.ch),this.ctx.stroke();for(o=1;5>o;o++)this.ctx.beginPath(),this.ctx.moveTo(0,this.ch/5*o-.5),this.ctx.lineTo(this.cw,this.ch/5*o-.5),this.ctx.stroke();for(this.ctx.lineWidth=.5,o=1;20>o;o++)this.ctx.beginPath(),this.ctx.moveTo(this.cw/20*o-.5,0),this.ctx.lineTo(this.cw/20*o-.5,this.ch),this.ctx.stroke();for(o=1;10>o;o++)this.ctx.beginPath(),this.ctx.moveTo(0,this.ch/10*o-.5),this.ctx.lineTo(this.cw,this.ch/10*o-.5),this.ctx.stroke();for(this.ctx.strokeStyle=this.lineColor,this.ctx.lineWidth=this.lineWidth,this.ctx.beginPath(),this.ctx.moveTo(this.points[0].position.x,this.points[0].position.y),o=1;o<this.points.length;o++){var t=this.points[o],i=this.points[o-1];this.ctx.bezierCurveTo(i.cp2.x,i.cp2.y,t.cp1.x,t.cp1.y,t.position.x,t.position.y)}this.ctx.stroke();for(var o=0;o<this.points.length;o++)this.points[o].draw()};var o=[];return window.addEventListener("keydown",function(t){o[t.keyCode]=!0}),window.addEventListener("keyup",function(t){delete o[t.keyCode]}),i}),o("main",["modules/Curve"],function(t){return t}),i("main")});
//# sourceMappingURL=almond.build.js.map
//# sourceMappingURL=curves.min.js.map
